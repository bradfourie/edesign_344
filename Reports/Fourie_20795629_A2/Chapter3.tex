\chapter{Current peak transducer}
\section{Theory and related work} \label{sec:literature_current_peak_transducer}
For the purpose of this design a simple capacitor diode peak detector could not be used as this would require a large RC constant, meaning that the design requirement of responding to a \SI{1}{V} in 1 second would not be met for large voltages. It was then required that the loading be taken off from the load resistor by using an op-amp as a buffer called a precision rectifier to reduce the discharge time of the capacitor to meet the design requirements. 

\section{Design} \label{sec:design_current_peak_transducer}
The current peak transistor in this design consisted of three elements, firstly a sense resistor was added in series with the load to turn a current measurement into a voltage measurement, this voltage measurement was then amplified to a suitable voltage level usable by the peak transducer.\newline
For the purpose of this design a $\SI{30}{\milli \Omega}$ sense resistor was chosen to ensure a reasonable trade off between power losses in the system and the measured voltage level over the sense resistor. It was found that a smaller sense resistor would by Ohm's law have a smaller voltage drop over it, and this in return would require a larger voltage gain stage, which was not desirable as such a large gain would require a very large feedback resistor, with a very large deviation from its given resistance. It was chosen that the current peak transducer would be able to measure a maximum current of \SI{350}{\milli A}, this corresponded to a sense voltage of \SI{10.5}{\milli V}.\newline
Given that the Arduino's maximum pin voltage was given as \SI{5}{\volt}, and to ensure a maximum resolution for the \SI{350}{\milli A} measurement range, the \SI{10.5}{\milli V} maximum sense voltage had to be amplified using an operational amplifier. This operational amplifier configuration was chosen as a differential mode non-inverting amplifier utilizing both the \SI{5}{\volt} and the \SI{-5}{\volt} rails as its power supplies. It was found that the maximum input to any of the operational amplifiers pins was not to exceed \SI{5}{\volt} or \SI{-5.3}{\volt} \ref{yourmom}.
The desired gain, and ratio between input resistor $R_1$, and feedback resistor $R_2$ was calculated by using Equation \ref{eq:opampgain}. Here $R_1$ was chosen as $\SI{1}{\kilo \Omega}$, and given this $R_2$ was found to be $\SI{470}{\kilo \Omega}$.\newline
\begin{align}
   \frac{V_{out}}{V_{in}}=1+\frac{R_2}{R_1}
   \label{eq:opampgain}
\end{align}
Given that the sense voltage was now amplified to a suitable range between 0 and \SI{5}{\volt} the same design procedure as Section \ref{sec:design_voltage_peak_transducer} could be applied to measure the amplitude of the peak of the sinusoidal input. This precision rectifier circuit utilised both the \SI{5}{\volt} and the \SI{-5}{\volt} rails as its power supplies, and thus it was not required that the negative half cycle of the sinusoidal input, with a maximum peak of \SI{5}{\volt}, be rectified as the minimum differential mode input to the operational amplifier was \SI{-5.3}{\volt}. The output capacitor to the peak detector was calculated in exactly the same way as before and the desired value was found as $\SI{1}{\micro F}$.

\begin{figure}[h!]
    \centering
    \includegraphics[width = 0.65\linewidth]{Figures/currentpeakdetector.pdf}
        \caption{Current Peak Transducer Diagram}
    \label{fig:currentpeakdetector.pdf}
\end{figure}

\section{Simulation} \label{sec:simulation_switchmode}

\section{Measurements} \label{sec:measurements_switchmode}








