Version 4
SHEET 1 4576 2052
WIRE 672 -384 592 -384
WIRE 832 -384 736 -384
WIRE 2080 -384 1968 -384
WIRE 2256 -384 2160 -384
WIRE 1680 -336 1648 -336
WIRE 1744 -336 1728 -336
WIRE 1792 -336 1744 -336
WIRE 1792 -288 1792 -336
WIRE 592 -256 592 -384
WIRE 592 -256 512 -256
WIRE 672 -256 592 -256
WIRE 832 -256 832 -384
WIRE 832 -256 752 -256
WIRE 1136 -256 832 -256
WIRE 2064 -256 2064 -288
WIRE 1968 -240 1968 -384
WIRE 2032 -240 1968 -240
WIRE 512 -224 512 -256
WIRE 2144 -224 2096 -224
WIRE 2256 -224 2256 -384
WIRE 2256 -224 2208 -224
WIRE 2368 -224 2256 -224
WIRE 2416 -224 2368 -224
WIRE 1792 -208 1744 -208
WIRE 1872 -208 1792 -208
WIRE 2032 -208 1952 -208
WIRE 2256 -192 2256 -224
WIRE 2368 -176 2368 -224
WIRE 944 -128 896 -128
WIRE 2064 -128 2064 -192
WIRE 512 -112 512 -144
WIRE 944 -96 944 -128
WIRE 1792 -80 1792 -128
WIRE 2256 -80 2256 -112
WIRE 2368 -80 2368 -112
WIRE 592 -64 592 -256
WIRE 656 -64 592 -64
WIRE 896 -64 896 -128
WIRE 896 -64 864 -64
WIRE 976 -32 864 -32
WIRE 1024 -32 976 -32
WIRE 1136 -32 1136 -256
WIRE 1136 -32 1104 -32
WIRE 1248 -32 1136 -32
WIRE 1344 -32 1248 -32
WIRE 176 0 80 0
WIRE 288 0 240 0
WIRE 400 0 288 0
WIRE 480 0 400 0
WIRE 656 0 480 0
WIRE 896 0 864 0
WIRE 1136 0 1136 -32
WIRE 1248 0 1248 -32
WIRE 976 32 976 -32
WIRE 1616 32 1568 32
WIRE 1728 32 1696 32
WIRE 1792 32 1728 32
WIRE 1920 32 1872 32
WIRE 2144 32 2032 32
WIRE 2320 32 2224 32
WIRE 288 48 288 0
WIRE 896 48 896 0
WIRE 400 64 400 0
WIRE 480 64 480 0
WIRE 512 64 480 64
WIRE 1568 64 1568 32
WIRE 976 160 976 96
WIRE 1136 160 1136 64
WIRE 1248 160 1248 80
WIRE 2128 160 2128 128
WIRE 1824 176 1824 144
WIRE 2032 176 2032 32
WIRE 2096 176 2032 176
WIRE 288 192 288 128
WIRE 400 192 400 128
WIRE 1728 192 1728 32
WIRE 1792 192 1728 192
WIRE 2208 192 2160 192
WIRE 2320 192 2320 32
WIRE 2320 192 2272 192
WIRE 2432 192 2320 192
WIRE 2496 192 2432 192
WIRE 1920 208 1920 32
WIRE 1920 208 1856 208
WIRE 1936 208 1920 208
WIRE 2096 208 2016 208
WIRE 1792 224 1664 224
WIRE 2320 224 2320 192
WIRE 2432 240 2432 192
WIRE 2128 272 2128 224
WIRE 1824 288 1824 240
WIRE 1920 288 1920 208
WIRE 176 336 96 336
WIRE 336 336 256 336
WIRE 2320 336 2320 304
WIRE 2432 336 2432 304
WIRE 1344 384 1232 384
WIRE 336 400 336 336
WIRE 368 400 336 400
WIRE 464 400 432 400
WIRE 512 400 464 400
WIRE 640 400 576 400
WIRE 800 400 640 400
WIRE 848 400 800 400
WIRE 1104 400 1040 400
WIRE 1168 400 1104 400
WIRE 1296 416 1232 416
WIRE 2160 416 2160 384
WIRE 1344 432 1344 384
WIRE 2128 432 2096 432
WIRE 2272 448 2192 448
WIRE 336 464 336 400
WIRE 2128 464 2096 464
WIRE 464 480 464 400
WIRE 800 480 800 400
WIRE 640 496 640 400
WIRE 1680 496 1680 480
WIRE 1872 496 1872 480
WIRE 128 512 80 512
WIRE 272 512 208 512
WIRE 1296 512 1296 416
WIRE 1360 512 1296 512
WIRE 1104 528 1104 400
WIRE 2160 528 2160 480
WIRE 2384 544 2352 544
WIRE 2272 560 2272 448
WIRE 2288 560 2272 560
WIRE 1296 576 1296 512
WIRE 2416 576 2416 528
WIRE 2416 576 2352 576
WIRE 2448 576 2416 576
WIRE 2560 576 2528 576
WIRE 2608 576 2560 576
WIRE 1680 592 1680 576
WIRE 1680 592 1648 592
WIRE 1872 592 1872 576
WIRE 1872 592 1840 592
WIRE 2560 592 2560 576
WIRE 1680 608 1680 592
WIRE 1872 608 1872 592
WIRE 464 640 464 544
WIRE 640 640 640 560
WIRE 640 640 464 640
WIRE 800 640 800 544
WIRE 800 640 640 640
WIRE 2160 640 2160 608
WIRE 2128 656 2096 656
WIRE 2384 672 2384 544
WIRE 2384 672 2192 672
WIRE 2128 688 2096 688
WIRE 336 704 336 560
WIRE 640 704 640 640
WIRE 1104 704 1104 592
WIRE 1296 704 1296 640
WIRE 1680 704 1680 688
WIRE 1872 704 1872 688
WIRE 2560 720 2560 656
WIRE 2160 752 2160 704
WIRE 1312 848 1312 832
WIRE 1680 896 1680 848
WIRE 2080 896 2080 848
WIRE 432 912 432 896
WIRE 1040 912 1040 896
WIRE 2336 928 2336 896
WIRE 1312 944 1312 928
WIRE 1392 944 1312 944
WIRE 1312 960 1312 944
WIRE 752 976 752 944
WIRE 720 992 688 992
WIRE 432 1008 432 992
WIRE 432 1008 400 1008
WIRE 848 1008 784 1008
WIRE 1040 1008 1040 992
WIRE 1040 1008 1008 1008
WIRE 1184 1008 1040 1008
WIRE 1248 1008 1184 1008
WIRE 432 1024 432 1008
WIRE 720 1024 688 1024
WIRE 1040 1024 1040 1008
WIRE 1184 1024 1184 1008
WIRE 1680 1024 1680 976
WIRE 1696 1024 1680 1024
WIRE 1840 1024 1776 1024
WIRE 1984 1024 1936 1024
WIRE 2080 1024 2080 976
WIRE 2080 1024 2064 1024
WIRE 2336 1024 2336 1008
WIRE 2416 1024 2336 1024
WIRE 2560 1024 2480 1024
WIRE 2416 1056 2336 1056
WIRE 2592 1056 2480 1056
WIRE 2688 1056 2592 1056
WIRE 1680 1072 1680 1024
WIRE 1680 1072 1568 1072
WIRE 2080 1072 2080 1024
WIRE 2176 1072 2080 1072
WIRE 2592 1088 2592 1056
WIRE 2592 1088 2528 1088
WIRE 2656 1088 2592 1088
WIRE 752 1104 752 1040
WIRE 432 1120 432 1104
WIRE 1040 1120 1040 1104
WIRE 1184 1120 1184 1088
WIRE 1312 1120 1312 1056
WIRE 1840 1120 1936 1024
WIRE 1936 1120 1840 1024
WIRE 1680 1136 1680 1072
WIRE 2080 1136 2080 1072
WIRE 2528 1136 2528 1088
WIRE 2656 1136 2656 1088
WIRE 1840 1184 1840 1120
WIRE 1840 1184 1744 1184
WIRE 1936 1184 1936 1120
WIRE 2016 1184 1936 1184
WIRE 96 1200 96 1120
WIRE 208 1216 208 1104
WIRE 1680 1264 1680 1232
WIRE 2080 1264 2080 1232
WIRE 2528 1264 2528 1216
WIRE 2528 1264 2512 1264
WIRE 2592 1264 2528 1264
WIRE 2656 1264 2656 1200
WIRE 2656 1264 2592 1264
WIRE 2592 1296 2592 1264
WIRE 96 1344 96 1280
WIRE 208 1344 208 1296
WIRE 1632 1360 1600 1360
WIRE 1840 1360 1840 1184
WIRE 1840 1360 1712 1360
WIRE 1936 1360 1936 1184
WIRE 2064 1360 1936 1360
WIRE 2176 1360 2144 1360
WIRE 2592 1392 2592 1376
FLAG 336 704 0
FLAG 640 704 0
FLAG 96 1344 0
FLAG 288 192 0
FLAG 400 192 0
FLAG 512 -112 0
FLAG 944 -96 0
FLAG 896 48 0
FLAG 976 160 0
FLAG 1136 160 0
FLAG 1248 160 0
FLAG 1104 704 0
FLAG 1296 704 0
FLAG 1344 432 0
FLAG 848 400 -5V
IOPIN 848 400 Out
FLAG 96 336 12V
IOPIN 96 336 Out
FLAG 1360 512 5V
IOPIN 1360 512 Out
FLAG 512 64 Vrect
IOPIN 512 64 Out
FLAG 1344 -32 12V
IOPIN 1344 -32 Out
FLAG 1040 400 12V
IOPIN 1040 400 Out
FLAG 2064 -288 5V
IOPIN 2064 -288 Out
FLAG 2368 -80 0
FLAG 1792 -80 0
FLAG 2256 -80 0
FLAG 1648 -336 Vload
IOPIN 1648 -336 Out
FLAG 2416 -224 voltage_peak
IOPIN 2416 -224 Out
FLAG 2064 -128 0
FLAG 1744 -208 v_meas
IOPIN 1744 -208 Out
FLAG 2128 128 5V
IOPIN 2128 128 Out
FLAG 2432 336 0
FLAG 2320 336 0
FLAG 2496 192 current_peak
IOPIN 2496 192 Out
FLAG 1824 144 5V
IOPIN 1824 144 Out
FLAG 1664 224 input_i
IOPIN 1664 224 Out
FLAG 1568 64 0
FLAG 1920 288 i_meas
IOPIN 1920 288 Out
FLAG 2096 464 v_meas
IOPIN 2096 464 Out
FLAG 2160 384 5V
IOPIN 2160 384 Out
FLAG 2160 528 0
FLAG 2416 528 pwm
IOPIN 2416 528 Out
FLAG 2096 688 i_meas
IOPIN 2096 688 Out
FLAG 2160 608 5V
IOPIN 2160 608 Out
FLAG 2160 752 0
FLAG 2560 720 0
FLAG 1872 704 0
FLAG 1872 480 5V
IOPIN 1872 480 Out
FLAG 1840 592 ref1
IOPIN 1840 592 Out
FLAG 2096 432 ref1
IOPIN 2096 432 Out
FLAG 2096 656 ref2
IOPIN 2096 656 Out
FLAG 1680 704 0
FLAG 1680 480 5V
IOPIN 1680 480 Out
FLAG 1648 592 ref2
IOPIN 1648 592 Out
FLAG 2592 1392 0
FLAG 2512 1264 input_i
IOPIN 2512 1264 Out
FLAG 1824 288 0
FLAG 2128 272 0
FLAG 96 1120 Vsupply
IOPIN 96 1120 Out
FLAG 208 1344 0
FLAG 208 1104 Vpulse
IOPIN 208 1104 Out
FLAG 80 0 Vsupply
IOPIN 80 0 Out
FLAG 80 512 Vpulse
IOPIN 80 512 Out
FLAG 1680 1264 0
FLAG 2080 1264 0
FLAG 1680 848 5V
IOPIN 1680 848 Out
FLAG 2080 848 5V
IOPIN 2080 848 Out
FLAG 2176 1072 Qbar
IOPIN 2176 1072 Out
FLAG 1568 1072 Q
IOPIN 1568 1072 Out
FLAG 1600 1360 reset
IOPIN 1600 1360 Out
FLAG 2176 1360 set
IOPIN 2176 1360 Out
FLAG 432 1120 0
FLAG 432 896 5V
IOPIN 432 896 Out
FLAG 400 1008 ref3
IOPIN 400 1008 Out
FLAG 688 1024 current_peak
IOPIN 688 1024 Out
FLAG 752 944 5V
IOPIN 752 944 Out
FLAG 752 1104 0
FLAG 688 992 ref3
IOPIN 688 992 Out
FLAG 2336 1056 Q
IOPIN 2336 1056 Out
FLAG 2336 896 5V
IOPIN 2336 896 Out
FLAG 2560 1024 Vsupply
IOPIN 2560 1024 Out
FLAG 848 1008 set
IOPIN 848 1008 Out
FLAG 1040 1120 0
FLAG 1040 896 5V
IOPIN 1040 896 Out
FLAG 1008 1008 ref4
IOPIN 1008 1008 Out
FLAG 1184 1120 0
FLAG 1312 1120 0
FLAG 1312 832 5V
IOPIN 1312 832 Out
FLAG 1392 944 reset
IOPIN 1392 944 Out
FLAG 2688 1056 Vload
IOPIN 2688 1056 Out
FLAG 2608 576 phase
IOPIN 2608 576 Out
SYMBOL npn 272 464 R0
WINDOW 3 54 68 Left 2
SYMATTR Value 2N3904
SYMATTR InstName Q1
SYMBOL res 224 496 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 10k
SYMBOL res 272 320 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 200
SYMBOL cap 624 496 R0
SYMATTR InstName C1
SYMATTR Value 1000µ
SYMBOL cap 432 384 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C2
SYMATTR Value 10µ
SYMBOL diode 448 480 R0
WINDOW 3 30 61 Left 2
SYMATTR Value D1N4007
SYMATTR InstName D1
SYMBOL diode 576 384 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D2
SYMATTR Value D1N4007
SYMBOL voltage 96 1184 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 0 -61 10 Left 2
WINDOW 3 -210 123 Left 2
SYMATTR InstName V2
SYMATTR Value SINE(0 25.46 50)
SYMBOL res 272 32 R0
SYMATTR InstName R3
SYMATTR Value 180
SYMBOL diode 176 16 R270
WINDOW 3 -7 33 VBottom 2
WINDOW 0 38 31 VTop 2
SYMATTR Value D1N4007
SYMATTR InstName D3
SYMBOL cap 384 64 R0
SYMATTR InstName C3
SYMATTR Value 220µ
SYMATTR SpiceLine V=35
SYMBOL res 496 -240 R0
SYMATTR InstName R4
SYMATTR Value 1k
SYMBOL res 768 -272 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value 8.756k
SYMBOL cap 736 -400 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName CFF1
SYMATTR Value 1.5n
SYMBOL ind 1120 -48 R90
WINDOW 0 5 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName L1
SYMATTR Value 68µ
SYMBOL schottky 992 96 R180
WINDOW 0 24 64 Left 2
WINDOW 3 -123 -10 Left 2
SYMATTR InstName D4
SYMATTR Value RB055L-60
SYMATTR Description Zener Diode
SYMATTR Type zener
SYMBOL cap 1120 0 R0
SYMATTR InstName COUT1
SYMATTR Value 100µ
SYMATTR SpiceLine V=35
SYMBOL res 1232 -16 R0
SYMATTR InstName RL1
SYMATTR Value 60
SYMBOL cap 1088 528 R0
WINDOW 0 -39 11 Left 2
WINDOW 3 -64 42 Left 2
SYMATTR InstName C4
SYMATTR Value 100n
SYMBOL cap 1280 576 R0
WINDOW 0 30 1 Left 2
WINDOW 3 41 37 Left 2
SYMATTR InstName C5
SYMATTR Value 100n
SYMBOL AutoGenerated\\1N4733A 800 512 R90
SYMATTR InstName U1
SYMBOL AutoGenerated\\LM7805 1200 400 R0
SYMATTR InstName U2
SYMBOL AutoGenerated\\LM2595_ADJ_TRANS 752 -32 R0
SYMATTR InstName U3
SYMBOL Opamps\\opamp2 2064 -288 R0
WINDOW 3 -108 113 Left 2
SYMATTR Value TLC2272
SYMATTR InstName U4
SYMBOL res 1776 -304 R0
SYMATTR InstName R6
SYMATTR Value 56k
SYMBOL res 1776 -224 R0
SYMATTR InstName R7
SYMATTR Value 10k
SYMBOL res 2176 -400 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value 10k
SYMBOL cap 2352 -176 R0
WINDOW 0 32 -6 Left 2
SYMATTR InstName C6
SYMATTR Value 20µ
SYMBOL res 2240 -208 R0
WINDOW 3 41 74 Left 2
SYMATTR Value 1000k
SYMATTR InstName R9
SYMBOL diode 2144 -240 M90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D5
SYMATTR Value D1N4007
SYMBOL res 1968 -224 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R10
SYMATTR Value 10k
SYMBOL diode 1680 -352 M90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D6
SYMATTR Value D1N4007
SYMBOL Opamps\\opamp2 2128 128 R0
WINDOW 3 -108 113 Left 2
SYMATTR Value TLC2272
SYMATTR InstName U5
SYMBOL res 2240 16 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R11
SYMATTR Value 10k
SYMBOL cap 2416 240 R0
WINDOW 0 32 -6 Left 2
SYMATTR InstName C7
SYMATTR Value 20µ
SYMBOL res 2304 208 R0
WINDOW 3 41 74 Left 2
SYMATTR Value 1000k
SYMATTR InstName R12
SYMBOL diode 2208 176 M90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D7
SYMATTR Value D1N4007
SYMBOL Opamps\\opamp2 1824 144 R0
WINDOW 3 -108 113 Left 2
SYMATTR Value TLC2272
SYMATTR InstName U6
SYMBOL res 1888 16 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R13
SYMATTR Value 470k
SYMBOL res 1712 16 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R14
SYMATTR Value 1k
SYMBOL res 2032 192 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R15
SYMATTR Value 10k
SYMBOL Opamps\\opamp2 2160 384 R0
WINDOW 3 -119 118 Left 2
SYMATTR Value TLC2272
SYMATTR InstName U7
SYMBOL Opamps\\opamp2 2160 608 R0
WINDOW 3 -122 115 Left 2
SYMATTR Value TLC2272
SYMATTR InstName U8
SYMBOL cap 2544 592 R0
SYMATTR InstName C8
SYMATTR Value 20µ
SYMBOL res 2544 560 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R16
SYMATTR Value 56k
SYMBOL res 1856 592 R0
SYMATTR InstName R17
SYMATTR Value 1.995k
SYMBOL res 1856 480 R0
SYMATTR InstName R18
SYMATTR Value 100k
SYMBOL res 1664 592 R0
SYMATTR InstName R19
SYMATTR Value 1.995k
SYMBOL res 1664 480 R0
SYMATTR InstName R20
SYMATTR Value 100k
SYMBOL res 2512 1120 R0
SYMATTR InstName R21
SYMATTR Value 1k
SYMBOL cap 2640 1136 R0
SYMATTR InstName C9
SYMATTR Value 22µ
SYMBOL res 2576 1280 R0
SYMATTR InstName R22
SYMATTR Value 0.03
SYMBOL voltage 208 1200 R0
WINDOW 0 -72 15 Left 2
WINDOW 3 6 101 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V3
SYMATTR Value PULSE(0 5 0 0 0 25u 50u)
SYMBOL npn 1744 1136 M0
SYMATTR InstName Q2
SYMATTR Value 2N3904
SYMBOL npn 2016 1136 R0
SYMATTR InstName Q3
SYMATTR Value 2N3904
SYMBOL res 1664 880 R0
SYMATTR InstName R23
SYMATTR Value 1.8k
SYMBOL res 2064 880 R0
SYMATTR InstName R24
SYMATTR Value 1.8k
SYMBOL res 2080 1008 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R25
SYMATTR Value 12k
SYMBOL res 1792 1008 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R26
SYMATTR Value 12k
SYMBOL res 1728 1344 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R27
SYMATTR Value 12k
SYMBOL res 2048 1344 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R28
SYMATTR Value 12k
SYMBOL res 416 1008 R0
SYMATTR InstName R29
SYMATTR Value 10k
SYMBOL res 416 896 R0
SYMATTR InstName R30
SYMATTR Value 7.54k
SYMBOL Opamps\\opamp2 752 944 R0
WINDOW 3 -119 118 Left 2
SYMATTR Value TLC2272
SYMATTR InstName U10
SYMBOL res 2320 912 R0
SYMATTR InstName R32
SYMATTR Value 220
SYMBOL res 1024 1008 R0
SYMATTR InstName R33
SYMATTR Value 12k
SYMBOL res 1024 896 R0
SYMATTR InstName R34
SYMATTR Value 47k
SYMBOL cap 1168 1024 R0
SYMATTR InstName C10
SYMATTR Value 10µ
SYMBOL npn 1248 960 R0
SYMATTR InstName Q4
SYMATTR Value 2N3904
SYMBOL res 1296 832 R0
SYMATTR InstName R35
SYMATTR Value 12k
SYMBOL AutoGenerated\\MOC3020 2448 1040 R0
SYMATTR InstName U11
SYMBOL AutoGenerated\\XOR_2 2320 560 R0
SYMATTR InstName U12
TEXT 16 784 Left 2 !.lib 1N4733A.lib
TEXT 16 808 Left 2 !.lib D1N4007.lib
TEXT 16 832 Left 2 !.lib LM2595.lib
TEXT 16 856 Left 2 !.lib LM7805.lib
TEXT 16 880 Left 2 !.inc TLC2272.lib
TEXT 16 904 Left 2 !.inc digital.lib
TEXT 16 960 Left 2 !.tran 0 1.5 0 800m uic
TEXT 16 760 Left 2 !.lib MOC302x.lib
TEXT 16 928 Left 2 !.inc BT134.lib
